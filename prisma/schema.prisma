generator client {
  provider = "prisma-client-js"
  previewFeatures = ["fullTextIndex", "fullTextSearch"]
}

generator kysely {
  provider = "prisma-kysely"
  output   = "../src/prisma/generated"
  fileName = "types.ts"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// 사용자 모델
model User {
  id           String    @id @db.VarChar(36)
  email        String    @unique
  password     String
  role         String    @default("USER")
  refreshToken String?   @db.Text
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  posts        Post[]
  comments     Comment[]

  @@map("users")
}

// 게시물 모델
model Post {
  id        Int       @id @default(autoincrement())
  title     String
  content   String    @db.Text
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  userId    String    @db.VarChar(36)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  comments  Comment[]

  // 개별 필드 검색용 인덱스
  @@fulltext([title])
  @@fulltext([content])
  @@fulltext([title, content])
  @@map("posts")
}

// 댓글 모델
model Comment {
  id        Int      @id @default(autoincrement())
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  postId    Int
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  userId    String   @db.VarChar(36)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@fulltext([content])
  @@map("comments")
}

// 배치 실행 로그 모델
model BatchLog {
  id          Int      @id @default(autoincrement())
  batchName   String   @db.VarChar(100)
  status      String   @db.VarChar(20) // SUCCESS, FAILURE, RUNNING
  startedAt   DateTime @default(now())
  completedAt DateTime?
  errorMessage String? @db.Text
  metadata    String?  @db.Text // JSON 형태로 추가 정보 저장

  @@index([batchName, startedAt])
  @@map("batch_logs")
}
